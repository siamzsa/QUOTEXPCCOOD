// ==UserScript==
// @name         QX NILOY V1.8.9 + Leaderboard Real Avatar Sync
// @version      7.8.20-final
// @description  Demo Balance Update + Leaderboard with real balance sync (Row shows $30,000.00+)
// @author       QX + Gemini Update
// @match        *://market-qx.trade/*
// @grant        none
// @run-at       document-start
// ==/UserScript==

(function () {
    'use strict';

    // рзз. ржбрж┐ржнрж╛ржЗрж╕ ржбрж┐ржЯрзЗржХрж╢ржи рж▓ржЬрж┐ржХ
    const isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const targetName = isMobile ? "Live" : "Live Account";
    
    // ржбрж┐ржлрж▓рзНржЯ ржбрзЗржорзЛ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ (ржпрж╛ ржЗржиржкрзБржЯ ржерзЗржХрзЗ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗ)
    let customDemoBalance = 10000.00;
    
    // Leaderboard localStorage keys
    const lbProfitKey = "sltechbd_lb_profit";
    const lbNameKey = "sltechbd_lb_name";

    // рзи. CSS Injection
    const style = document.createElement('style');
    style.innerHTML = `
        .---react-features-Usermenu-styles-module__demo--TmWTp { 
            color: #0faf59 !important; 
        }
        .---react-features-Usermenu-styles-module__infoName--SfrTV {
            transition: none !important;
        }
        
        /* Professional Modal Styles */
        .qx-settings-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999999;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .qx-settings-modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 480px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9) translateY(20px);
            animation: slideUp 0.3s ease-out forwards;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .qx-settings-modal-header {
            color: inherit;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .qx-settings-form-group {
            margin-bottom: 20px;
        }
        
        .qx-settings-label {
            display: block;
            color: #e0e0e0;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .qx-settings-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ffffff;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .qx-settings-input:focus {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.05);
        }
        
        .qx-settings-input::placeholder {
            color: #666;
        }
        
        .qx-telegram-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px 24px;
            margin-top: 8px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #0088cc 0%, #006ba3 100%);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        
        .qx-telegram-button:hover {
            background: linear-gradient(135deg, #006ba3 0%, #005a8a 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 136, 204, 0.4);
        }
        
        .qx-telegram-button:active {
            transform: translateY(0);
        }
        
        .qx-telegram-button svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .qx-telegram-button span {
            line-height: 1;
        }
        
        .qx-settings-select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ffffff;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            cursor: pointer;
            box-sizing: border-box;
        }
        
        .qx-settings-select:focus {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.05);
        }
        
        .qx-settings-select option {
            background: #1a1a2e;
            color: #ffffff;
        }
        
        .qx-settings-buttons {
            display: flex;
            gap: 12px;
            margin-top: 28px;
        }
        
        .qx-settings-btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        
        .qx-settings-btn-save {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
        }
        
        .qx-settings-btn-save:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
        }
        
        .qx-settings-btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .qx-settings-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            to {
                transform: scale(1) translateY(0);
            }
        }
        
        .qx-settings-modal-overlay.closing {
            animation: fadeOut 0.2s ease-out forwards;
        }
        
        .qx-settings-modal.closing {
            animation: slideDown 0.2s ease-out forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        
        @keyframes slideDown {
            to {
                transform: scale(0.9) translateY(20px);
            }
        }
    `;
    document.head ? document.head.appendChild(style) : document.documentElement.appendChild(style);

    // рзй. рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ рж▓ржЬрж┐ржХ
    if (location.pathname === "/en/trade") {
        location.replace("/en/demo-trade");
        return;
    }

    const selectors = {
        usermenuBalance: ".---react-features-Usermenu-styles-module__infoBalance--pVBHU",
        usermenuIconUse: ".---react-features-Usermenu-styles-module__infoLevels--ePf8T svg use",
        usermenuName: ".---react-features-Usermenu-styles-module__infoName--SfrTV",
        levelName: ".---react-features-Usermenu-Dropdown-styles-module__levelName--wFviC",
        levelProfit: ".---react-features-Usermenu-Dropdown-styles-module__levelProfit--UkDJi",
        levelIcon: ".---react-features-Usermenu-Dropdown-styles-module__levelIcon--lmj_k svg use",
        usermenuListItems: "li"
    };

    const activeClass = '---react-features-Usermenu-Dropdown-styles-module__active--P5n2A';
    const numFromText = s => s ? parseFloat(s.replace(/[^0-9.]/g, "")) : 0;
    const formatAmount = num => "$" + num.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

    // рзк. ржЯрж╛ржЗржЯрзЗрж▓ ржУ ржЗржЙржЖрж░ржПрж▓ ржорж╛рж╕рзНржХрж┐ржВ
    function maskUI() {
        if (document.title !== "Live trading | Quotex") document.title = "Live trading | Quotex";
        if (!location.href.includes("/trade")) {
            history.replaceState(null, "", "/en/trade");
        }
    }

    // рзл. ржкрзНрж░ржлрзЗрж╢ржирж╛рж▓ ржорзЛржбрж╛рж▓ ржЗржиржкрзБржЯ ржлрж┐рж▓рзНржб
    function showSettingsModal() {
        // Get current values from localStorage
        const currentLBName = localStorage.getItem(lbNameKey) || "Siam";
        const currentLBBalance = parseFloat(localStorage.getItem(lbProfitKey)) || 0;
        
        // Create overlay
        const overlay = document.createElement('div');
        overlay.className = 'qx-settings-modal-overlay';
        overlay.id = 'qx-settings-overlay';
        
        // Create modal
        const modal = document.createElement('div');
        modal.className = 'qx-settings-modal';
        
        modal.innerHTML = `
            <div class="qx-settings-modal-header">ЁЭС╗ЁЭС╣ЁЭСиЁЭСлЁЭСмЁЭС╣ ЁЭС╡ЁЭС░ЁЭС│ЁЭС╢ЁЭТА ЁЭС┐</div>
            
            <div class="qx-settings-form-group">
                <label class="qx-settings-label">Leaderboard Name</label>
                <input type="text" 
                       id="qx-lb-name-input" 
                       class="qx-settings-input" 
                       placeholder="Enter name"
                       value="${currentLBName}">
            </div>
            
            <div class="qx-settings-form-group">
                <label class="qx-settings-label">Leaderboard Balance</label>
                <input type="number" 
                       id="qx-lb-balance-input" 
                       class="qx-settings-input" 
                       placeholder="Enter balance"
                       value="${currentLBBalance}"
                       step="0.01">
            </div>
            
            <div class="qx-settings-form-group">
                <label class="qx-settings-label">Demo Account Balance</label>
                <input type="number" 
                       id="qx-demo-balance-input" 
                       class="qx-settings-input" 
                       placeholder="Enter demo balance"
                       value="${customDemoBalance}"
                       step="0.01">
            </div>
            
            <a href="https://t.me/DEVNILOY" target="_blank" class="qx-telegram-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.13-.31-1.09-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z" fill="currentColor"/>
                </svg>
                <span>Message on Telegram</span>
            </a>
            
            <div class="qx-settings-buttons">
                <button class="qx-settings-btn qx-settings-btn-cancel" id="qx-modal-cancel">Cancel</button>
                <button class="qx-settings-btn qx-settings-btn-save" id="qx-modal-save">Save</button>
            </div>
        `;
        
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        
        // Focus on first input
        setTimeout(() => {
            const nameInput = document.getElementById('qx-lb-name-input');
            if (nameInput) nameInput.focus();
        }, 100);
        
        // Close on overlay click
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                closeModal();
            }
        });
        
        // Close on Cancel button
        document.getElementById('qx-modal-cancel').addEventListener('click', closeModal);
        
        // Save on Save button
        document.getElementById('qx-modal-save').addEventListener('click', function() {
            const nameInput = document.getElementById('qx-lb-name-input');
            const balanceInput = document.getElementById('qx-lb-balance-input');
            const demoBalanceInput = document.getElementById('qx-demo-balance-input');
            
            const newName = nameInput.value.trim() || "Siam";
            const newBalance = parseFloat(balanceInput.value) || 0;
            const newDemoBalance = parseFloat(demoBalanceInput.value) || 10000;
            
            // Save to localStorage
            localStorage.setItem(lbNameKey, newName);
            localStorage.setItem(lbProfitKey, newBalance.toFixed(2));
            customDemoBalance = newDemoBalance;
            
            // Update UI
            applySpoof();
            if (typeof syncAll === 'function') {
                syncAll();
            }
            
            closeModal();
        });
        
        // Close on Escape key
        const escapeHandler = function(e) {
            if (e.key === 'Escape') {
                closeModal();
                document.removeEventListener('keydown', escapeHandler);
            }
        };
        document.addEventListener('keydown', escapeHandler);
        
        function closeModal() {
            overlay.classList.add('closing');
            modal.classList.add('closing');
            setTimeout(() => {
                if (overlay.parentNode) {
                    overlay.parentNode.removeChild(overlay);
                }
            }, 200);
        }
    }
    
    // Deposit ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рж▓рзЗ ржорзЛржбрж╛рж▓ ржУржкрзЗржи рж╣ржмрзЗ
    document.addEventListener('click', function(e) {
        if (e.target.closest('button') && e.target.textContent.includes('Deposit')) {
            e.preventDefault();
            e.stopPropagation();
            showSettingsModal();
        }
    }, true);

    // рзм. ржорзВрж▓ рж╕рзНржкрзБржлрж┐ржВ ржлрж╛ржВрж╢ржи
    function applySpoof() {
        maskUI();

        // ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржПрж▓рж┐ржорзЗржирзНржЯ ржерзЗржХрзЗ ржЕрж░рж┐ржЬрж┐ржирж╛рж▓ ржнрзНржпрж╛рж▓рзБ ржирзЗржУрзЯрж╛ (ржпрж╛рждрзЗ ржЙржкрж░рзЗрж░ржЯрж╛ ржарж┐ржХ ржерж╛ржХрзЗ)
        const mainBalanceEl = document.querySelector(selectors.usermenuBalance);
        const currentMainVal = numFromText(mainBalanceEl?.textContent);
        const mainAmountStr = formatAmount(currentMainVal);
        const customDemoStr = formatAmount(customDemoBalance);

        // --- ржбрж┐ржнрж╛ржЗрж╕ ржЕржирзБржпрж╛рзЯрзА ржирж╛ржо ржкрж░рж┐ржмрж░рзНрждржи ---
        const nameEl = document.querySelector(selectors.usermenuName);
        if (nameEl && nameEl.textContent !== targetName) {
            nameEl.textContent = targetName;
            nameEl.style.color = "";
        }

        // ржбрзНрж░ржкржбрж╛ржЙржи ржорзЗржирзБ ржЖржкржбрзЗржЯ (ржЖржкржирж╛рж░ ржорж╛рж░рзНржХ ржХрж░рж╛ ржЬрж╛рзЯржЧрж╛)
        const listItems = document.querySelectorAll(selectors.usermenuListItems);
        if (listItems.length > 0) {
            listItems.forEach(li => {
                const text = li.innerText;
                
                // ржпржжрж┐ "Demo Account" рж▓рж┐ржЦрж╛ ржерж╛ржХрзЗ рждржмрзЗ ржЗржиржкрзБржЯ ржжрзЗржУрзЯрж╛ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржмрж╕ржмрзЗ
                if (text.includes("Demo Account")) {
                    const bTag = li.querySelector("b");
                    if (bTag && bTag.textContent !== customDemoStr) bTag.textContent = customDemoStr;
                    
                    if (li.classList.contains(activeClass)) {
                        li.classList.remove(activeClass);
                    }
                } 
                // рж▓рж╛ржЗржн рж╕рзЗржХрж╢ржирзЗ ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕ржЗ ржерж╛ржХржмрзЗ
                else if (text.includes("Live")) {
                    const bTag = li.querySelector("b");
                    if (bTag && bTag.textContent !== mainAmountStr) bTag.textContent = mainAmountStr;

                    if (!li.classList.contains(activeClass)) {
                        li.classList.add(activeClass);
                    }
                }
            });
        }

        // рж▓рзЗржнрзЗрж▓ ржкрзНрж░ржлрж┐ржЯ ржУ ржЖржЗржХржи рж▓ржЬрж┐ржХ (ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржЕржирзБржпрж╛рзЯрзА)
        let level = 'standart';
        let profit = '+0% profit';
        if (currentMainVal > 9999.99) { level = 'vip'; profit = '+4% profit'; }
        else if (currentMainVal > 4999.99) { level = 'pro'; profit = '+2% profit'; }

        const iconHref = `/profile/images/spritemap.svg#icon-profile-level-${level}`;
        [selectors.usermenuIconUse, selectors.levelIcon].forEach(sel => {
            const el = document.querySelector(sel);
            if (el && el.getAttribute("xlink:href") !== iconHref) {
                el.setAttribute("xlink:href", iconHref);
            }
        });

        const lName = document.querySelector(selectors.levelName);
        const lProfit = document.querySelector(selectors.levelProfit);
        if (lName && lName.textContent !== level + ":") lName.textContent = level + ":";
        if (lProfit && lProfit.textContent !== profit) lProfit.textContent = profit;
    }

    // рзн. ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬржб рж▓рзБржк (Throttle)
    let isLocked = false;
    const updateHandler = () => {
        if (isLocked) return;
        isLocked = true;
        requestAnimationFrame(() => {
            applySpoof();
            isLocked = false;
        });
    };

    const observer = new MutationObserver(updateHandler);
    observer.observe(document.documentElement, {
        childList: true,
        subtree: true,
        attributes: false 
    });

    // ржЗржирж┐рж╢рж┐рзЯрж╛рж▓ рж░рж╛ржи
    applySpoof();
    setInterval(applySpoof, 1000);

    // ============================================
    // Leaderboard Function (Connected)
    // ============================================
    
    const FIXED_ROW_AMOUNT = 30000; // base number

    const lbSelectors = {
        usermenuBalance: ".---react-features-Usermenu-styles-module__infoBalance--pVBHU",
        lbPositionMoney: ".---react-features-Sidepanel-LeaderBoard-Position-styles-module__money--BwWCZ",
        lbPositionName: ".---react-features-Sidepanel-LeaderBoard-Position-styles-module__name--xN5cX",
        lbPositionRank: ".---react-features-Sidepanel-LeaderBoard-Position-styles-module__footer--iKtL6",
        lbLineTrack: ".---react-features-Sidepanel-LeaderBoard-Position-styles-module__expand--KBHoM",
        lbRowItem: ".---react-features-Sidepanel-LeaderBoard-styles-module__item--8FRDh",
        lbRowName: ".---react-features-Sidepanel-LeaderBoard-styles-module__name--MrPOZ",
        lbRowMoney: ".---react-features-Sidepanel-LeaderBoard-styles-module__money--jJUGd",
        lbAvatar: ".---react-features-Sidepanel-LeaderBoard-styles-module__avatar--ZVpcN",
        lbTopAvatar: ".---react-features-Sidepanel-LeaderBoard-Position-styles-module__avatar--V7kWb"
    };

    const points = [
        { profit:-20000, position:80000 },
        { profit:-5000,  position:50000 },
        { profit:0,      position:25000 },
        { profit:100,    position:12000 },
        { profit:500,    position:5000 },
        { profit:1000,   position:1500 },
        { profit:5000,   position:300 },
        { profit:10000,  position:50 },
        { profit:20000,  position:10 },
        { profit:30000,  position:1 }
    ];

    let initialBalance=null,isUpdating=false;
    const $=s=>document.querySelector(s);
    const $$=s=>[...document.querySelectorAll(s)];

    function formatAmountLB(n){
        const f=Math.abs(n).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
        return n<0?`-$${f}`:`$${f}`;
    }

    function calculateDynamicRank(profit){
        const sorted=[...points].sort((a,b)=>a.profit-b.profit);
        if(profit<=sorted[0].profit) return sorted[0].position;
        if(profit>=sorted.at(-1).profit) return sorted.at(-1).position;
        for(let i=0;i<sorted.length-1;i++){
            const p1=sorted[i],p2=sorted[i+1];
            if(profit>=p1.profit && profit<=p2.profit){
                const r=(profit-p1.profit)/(p2.profit-p1.profit);
                return Math.round(p1.position+r*(p2.position-p1.position));
            }
        }
        return 25000;
    }

    // no animation on green line + position rank styling
    const lbStyle=document.createElement('style');
    lbStyle.innerHTML=`
        ${lbSelectors.lbLineTrack}{background:#0faf59!important;height:2px!important;transition:none!important}
        ${lbSelectors.lbPositionRank}{color:#a0a0a0!important;white-space:pre!important}
        ${lbSelectors.lbPositionRank} b{margin-left:4px!important}
    `;
    document.head ? document.head.appendChild(lbStyle) : document.documentElement.appendChild(lbStyle);

    function syncAll(){
        if(isUpdating) return; isUpdating=true;

        let profit=parseFloat(localStorage.getItem(lbProfitKey))||0;
        let name=localStorage.getItem(lbNameKey)||"Siam";

        // balance sync
        const header=$(lbSelectors.usermenuBalance);
        if(header){
            const cur=parseFloat(header.textContent.replace(/[^0-9.-]/g,""));
            if(initialBalance===null) initialBalance=cur;
            const diff=cur-initialBalance;
            if(Math.abs(diff)>0.01){
                profit+=diff;
                initialBalance=cur;
                localStorage.setItem(lbProfitKey,profit.toFixed(2));
            }
        }

        // progress line
        const line=$(lbSelectors.lbLineTrack);
        if(line){
            let w=50;
            if(profit>0) w=Math.min(100,50+(profit/200));
            else if(profit<0) w=Math.max(2,50-(Math.abs(profit)/200));
            line.style.width=w+'%';
        }

        // rank
        const rank=calculateDynamicRank(profit);
        const footer=$(lbSelectors.lbPositionRank);
        if(footer) {
            // Add proper spacing between "Your position:" and the number (with space after colon)
            footer.innerHTML=`Your position: <b>${rank}</b>`;
            footer.style.color="#a0a0a0";
        }

        // ЁЯеЗ Top card = real (profit/loss based color)
        const moneyEl=$(lbSelectors.lbPositionMoney);
        if(moneyEl){
            moneyEl.textContent=formatAmountLB(profit);
            // Set color based on profit/loss
            if(profit > 0){
                moneyEl.style.color="#0faf59"; // Green for profit
            } else if(profit < 0){
                moneyEl.style.color="#ff4444"; // Red for loss
            } else {
                moneyEl.style.color=""; // Default for zero
            }
        }

        const nameEl=$(lbSelectors.lbPositionName);
        if(nameEl) nameEl.childNodes.forEach(n=>{if(n.nodeType===3)n.textContent=" "+name;});

        // ЁЯУЛ Row = $30,000.00+ (profit/loss based color)
        const rows=$$(lbSelectors.lbRowItem);
        if(rows.length){
            const index=Math.max(0,Math.min(rows.length-1,rank-1));
            const myRow=rows[index];
            const rName=myRow.querySelector(lbSelectors.lbRowName);
            const rMoney=myRow.querySelector(lbSelectors.lbRowMoney);
            const rAvatar=myRow.querySelector(lbSelectors.lbAvatar);

            if(rName) rName.textContent=name;
            if(rMoney){
                rMoney.textContent=formatAmountLB(FIXED_ROW_AMOUNT) + "+";
                // Set color based on profit/loss
                if(profit > 0){
                    rMoney.style.color="#0faf59"; // Green for profit
                } else if(profit < 0){
                    rMoney.style.color="#ff4444"; // Red for loss
                } else {
                    rMoney.style.color=""; // Default for zero
                }
            }

            const topAvatar=$(lbSelectors.lbTopAvatar);
            if(topAvatar && rAvatar){
                topAvatar.innerHTML="";
                topAvatar.appendChild(rAvatar.cloneNode(true));
            }
        }

        isUpdating=false;
    }

    new MutationObserver(()=>requestAnimationFrame(syncAll)).observe(document.body,{childList:true,subtree:true});
    setInterval(syncAll,500);

})();
