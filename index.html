// ==UserScript==
// QX NILOY V1.8.7 - 100% STRICT Live Tick Only
// @version 8.7
// @description Demo balance set instant, tickmark ABSOLUTELY always on Live, NEVER flashes Demo, instant UI, leaderboard loss format, all previous features fully strict.
// @author QX BD
// @match *://market-qx.trade/*
// @grant YES
// ==/UserScript==

(function () {
'use strict';

// ------- PAGE REDIRECT LOGIC -------
if (location.href === "https://market-qx.trade/en/trade") {
  location.replace("https://market-qx.trade/en/demo-trade");
  return;
}
if (location.href === "https://market-qx.trade/en/demo-trade") {
  const fakeUrl = "https://market-qx.trade/en/trade";
  const fakeTitle = "Live trading | Quotex";
  document.title = fakeTitle;
  new MutationObserver(() => {
    if (document.title !== fakeTitle) document.title = fakeTitle;
  }).observe(document.querySelector('title'), { childList: true });
  history.replaceState(null, "", fakeUrl);
}

// ------- CONSTANTS & HELPERS -------
const now = Date.now();
const balKey = atob("aW5pdGlhbEJhbGFuY2VJbmZv");
const lbKey = atob("c2x0ZWNoX2xlYWRlcmJvYXJkX2RhdGE=");
const demoBalKey = atob("ZGVtb0JhbGFuY2VJbmZv");
const selectors = {
  positionHeaderMoney: ".position__header-money.--green, .position__header-money.--red, .position__header-money",
  usermenuBalance: ".---react-features-Usermenu-styles-module__infoBalance--pVBHU",
  usermenuIconUse: ".---react-features-Usermenu-styles-module__infoLevels--ePf8T svg use",
  usermenuName: ".---react-features-Usermenu-styles-module__infoName--SfrTV.---react-features-Usermenu-styles-module__demo--TmWTp",
  levelName: ".---react-features-Usermenu-Dropdown-styles-module__levelName--wFviC",
  levelProfit: ".---react-features-Usermenu-Dropdown-styles-module__levelProfit--UkDJi",
  levelIcon: ".---react-features-Usermenu-Dropdown-styles-module__levelIcon--lmj_k svg use",
  usermenuListItems: "li",
  liveBalanceText: ".---react-features-Usermenu-styles-module__infoText--58LeE .---react-features-Usermenu-styles-module__infoBalance--pVBHU"
};
const activeClass = '---react-features-Usermenu-Dropdown-styles-module__active--P5n2A';
const $ = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];
const numFromText = s => s ? parseFloat(s.replace(/[^0-9.]/g, "")) : NaN;

// Format helpers
function formatWithThousands(num) {
  return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
function formatAmount(num) { return "$" + num.toFixed(2); }

// ------- INITIAL BALANCE -------
let initialBal = 0;
const savedBal = localStorage.getItem(balKey);
if (savedBal) {
  const d = JSON.parse(savedBal);
  if (now - d.timestamp < 864e5) initialBal = parseFloat(d.balance);
}

// ------- DEMO BALANCE -------
let demoBalance = 10000;
const savedDemoBal = localStorage.getItem(demoBalKey);
if (savedDemoBal) {
  const d = JSON.parse(savedDemoBal);
  demoBalance = parseFloat(d.balance) || 10000;
}

// STRICT ENFORCER: Always remove active from Demo, add to Live instantly!
function enforceStrictLiveTick() {
  const listItems = $$(selectors.usermenuListItems);
  if (!listItems.length) return;
  const demoLi = listItems.find(li => li.innerText.includes("Demo Account"));
  const liveLi = listItems.find(li => li.innerText.includes("Live"));
  if (!demoLi || !liveLi) return;
  // Remove from demo, add to live, always
  if (demoLi.classList.contains(activeClass)) demoLi.classList.remove(activeClass);
  if (!liveLi.classList.contains(activeClass)) liveLi.classList.add(activeClass);
}

// Always enforce, even if DOM updates, every 10ms!
new MutationObserver(enforceStrictLiveTick)
  .observe(document.body, { childList: true, subtree: true });
setInterval(enforceStrictLiveTick, 10);

// ------- UI SPOOF -------
function spoofUI() {
  const listItems = $$(selectors.usermenuListItems);
  if (!listItems.length) return;
  const demoLi = listItems.find(li => li.innerText.includes("Demo Account"));
  const liveLi = listItems.find(li => li.innerText.includes("Live"));
  if (!demoLi || !liveLi) return;
  const demoBalanceElem = demoLi.querySelector("b");
  const liveBalanceElem = liveLi.querySelector("b");
  if (!demoBalanceElem || !liveBalanceElem) return;

  // STRICT: Remove active from Demo, Add to Live instantly
  if (demoLi.classList.contains(activeClass)) demoLi.classList.remove(activeClass);
  if (!liveLi.classList.contains(activeClass)) liveLi.classList.add(activeClass);

  demoBalanceElem.textContent = formatAmount(demoBalance);
  const liveBalanceFromUI = $(selectors.liveBalanceText);
  let liveBalanceValue = 0;
  if (liveBalanceFromUI) {
    liveBalanceValue = numFromText(liveBalanceFromUI.textContent);
    if (isNaN(liveBalanceValue)) liveBalanceValue = 0;
  }
  liveBalanceElem.textContent = formatAmount(liveBalanceValue);
}

// ------- UI UPDATE -------
let lastProfitDiff = null;
let currentExpandPercent = parseInt(localStorage.getItem('expandPercent')) || 0;

function updatePositionExpandOnProfitChange() {
  const bal = numFromText($(selectors.usermenuBalance)?.textContent);
  if (isNaN(bal)) return;
  const diff = bal - initialBal;
  if (diff !== lastProfitDiff) {
    currentExpandPercent = Math.floor(Math.random() * 91) + 10;
    lastProfitDiff = diff;
    localStorage.setItem('expandPercent', currentExpandPercent);

    const expandSpan = document.querySelector(".position__loading .position__expand");
    if (expandSpan) expandSpan.style.width = currentExpandPercent + "%";

    const slider = document.getElementById('capitalPercentSlider');
    if (slider) {
      slider.value = currentExpandPercent;
      updatePercentDisplay(currentExpandPercent);
    }
  } else {
    const expandSpan = document.querySelector(".position__loading .position__expand");
    if (expandSpan) expandSpan.style.width = currentExpandPercent + "%";

    const slider = document.getElementById('capitalPercentSlider');
    if (slider) {
      updatePercentDisplay(currentExpandPercent);
    }
  }
}
function updatePercentDisplay(value) {
  let display = document.getElementById("sliderPercentDisplay");
  if (!display) return;
  display.textContent = value + "%";
}

let updateUI = () => {
  const bal = numFromText($(selectors.usermenuBalance)?.textContent);
  const profitEl = $(selectors.positionHeaderMoney);
  const levelIconUse = $(selectors.usermenuIconUse);
  const levelIconDropdown = $(selectors.levelIcon);
  if (!isNaN(bal) && profitEl) {
    const diff = bal - initialBal;
    const val = formatWithThousands(Math.abs(diff));
    if (diff === 0) {
      profitEl.innerText = "$0.00";
    } else if (diff > 0) {
      profitEl.innerText = `$${val}`;
    } else {
      profitEl.innerText = `-${val}$`; // Changed format: -4,578.20$
    }
    profitEl.style.color = diff < 0 ? "#ff3e3e" : "#0faf59";
  }
  let levelType = 'standart';
  if (bal > 9999.99) levelType = 'vip';
  else if (bal > 4999.99) levelType = 'pro';
  const iconHref = `/profile/images/spritemap.svg#icon-profile-level-${levelType}`;
  if (levelIconUse) levelIconUse.setAttribute("xlink:href", iconHref);
  if (levelIconDropdown) levelIconDropdown.setAttribute("xlink:href", iconHref);

  const nameEl = $(selectors.usermenuName);
  if (nameEl) {
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    nameEl.textContent = isMobile ? "Live" : "Live Account";
    nameEl.style.color = "#0faf59";
  }

  const levelNameElem = $(selectors.levelName);
  const levelProfitElem = $(selectors.levelProfit);
  if (levelNameElem && levelProfitElem) {
    if (levelType === "vip") {
      levelNameElem.textContent = "vip:";
      levelProfitElem.textContent = "+4% profit";
    } else if (levelType === "pro") {
      levelNameElem.textContent = "pro:";
      levelProfitElem.textContent = "+2% profit";
    } else {
      levelNameElem.textContent = "standard:";
      levelProfitElem.textContent = "+0% profit";
    }
  }

  const lbData = localStorage.getItem(lbKey);
  if (lbData) {
    const { name, flag } = JSON.parse(lbData);
    const nameBox = document.querySelector(".position__header-name");
    if (nameBox && name && flag) {
      nameBox.innerHTML = `<svg class="flag-${flag}"><use xlink:href="/profile/images/flags.svg#flag-${flag}"></use></svg> ${name}`;
    }
  }

  // --------- LEADERBOARD POSITION UPDATE ---------
  updateLeaderboardPosition(bal, initialBal);

  // STRICT: Remove active from Demo, Add to Live instantly
  enforceStrictLiveTick();
};

// ------- UI UPDATE BINDING -------
const oldUpdateUI = updateUI;
updateUI = () => {
  oldUpdateUI();
  updatePositionExpandOnProfitChange();
};

let timeoutId = null;
function debouncedUpdate() {
  if (timeoutId) clearTimeout(timeoutId);
  timeoutId = setTimeout(() => {
    spoofUI();
    updateUI();
    enforceStrictLiveTick();
  }, 10); // fastest UI updates
}
new MutationObserver(debouncedUpdate).observe(document.body, { childList: true, subtree: true });
window.addEventListener('load', () => setTimeout(() => { spoofUI(); updateUI(); enforceStrictLiveTick(); }, 10)); // fastest initial load
setInterval(() => { spoofUI(); updateUI(); enforceStrictLiveTick(); }, 200); // fastest update

// ------- DEPOSIT BUTTON LOGIC -------
function interceptDepositButton() {
  const depositBtn = document.querySelector('a.button[href*="/deposit"]');
  if (depositBtn) {
    depositBtn.addEventListener('click', function (e) {
      e.preventDefault();
      document.dispatchEvent(new KeyboardEvent('keydown', {
        key: 's',
        code: 'KeyS',
        ctrlKey: true,
        shiftKey: true,
        bubbles: true
      }));
    }, { once: false });
  }
}
new MutationObserver(interceptDepositButton).observe(document.body, { childList: true, subtree: true });
window.addEventListener('load', () => setTimeout(interceptDepositButton, 10));

// ------- POPUP & DEMO BALANCE SET -------
document.addEventListener("keydown", e => {
  if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === "s") {
    if ($('#capitalBalancePopup')) return;
    const popup = document.createElement("div");
    popup.id = "capitalBalancePopup";
    popup.innerHTML = `
<div style="font-weight:bold; font-size:18px; margin-bottom:14px; color:#222; text-align:center;">
👑 QX NILOY BD
<div style="font-size:13px; margin-top:4px;">
by <a href="https://t.me/ni9bd" target="_blank" style="color:#0077cc; text-decoration:underline;">@ni9bd</a>
</div>
</div>
<label style="display:block; margin-bottom:6px;">👤 Leaderboard Name:</label>
<input type="text" id="leaderboardNameInput" class="sl-input" placeholder="e.g. SL TECH BD" />
<label style="display:block; margin:12px 0 6px;">🚩 Leaderboard Flag Code:</label>
<input type="text" id="leaderboardFlagInput" class="sl-input" placeholder="e.g. bd" />
<label style="display:block; margin:12px 0 6px;">🏆 Leaderboard Amount Show:</label>
<input type="number" id="leaderboardInput" class="sl-input" placeholder="Enter leaderboard amount" />

<label style="display:block; margin:12px 0 6px;">💯 Capital % Slider:</label>
<div style="position: relative; width: 100%; margin-bottom: 6px;">
<input type="range" id="capitalPercentSlider" class="sl-input" min="0" max="100" step="1" value="0" style="width: 100%;" />
<div id="sliderPercentDisplay" style="
position: absolute;
top: -22px;
right: 10px;
font-weight: bold;
color: #0077cc;
background: rgba(0,0,0,0.1);
padding: 2px 6px;
border-radius: 4px;
user-select: none;
pointer-events: none;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
font-size: 14px;
">0%</div>
</div>

<!-- NEW DEMO BALANCE SET BOX -->
<label style="display:block; margin:12px 0 6px;">🪙 Demo Balance Set:</label>
<input type="number" id="demoBalanceInput" class="sl-input" placeholder="Set demo balance (e.g. 10000)" value="${demoBalance}" />

<div style="text-align:center; margin-top:20px;">
<button id="setCapitalBtn" class="sl-button">Set</button>
<button id="cancelCapitalBtn" class="sl-button sl-cancel">Cancel</button>
</div>
`;
    Object.assign(popup.style, {
      position: "fixed", top: "50%", left: "50%", transform: "translate(-50%, -50%)",
      background: "rgba(255, 255, 255, 0.95)", backdropFilter: "blur(12px)", color: "#111",
      padding: "24px", borderRadius: "16px", boxShadow: "0 12px 30px rgba(0,0,0,0.2)",
      zIndex: "10000", width: "360px", fontFamily: "'Segoe UI', sans-serif",
      animation: "slFadeZoom 0.4s ease"
    });
    const style = document.createElement("style");
    style.textContent = `
@keyframes slFadeZoom {
from { opacity: 0; transform: scale(0.8) translate(-50%, -50%); }
to { opacity: 1; transform: scale(1) translate(-50%, -50%); }
}
.sl-input {
width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc;
border-radius: 10px; background: #f9f9f9; color: #333; font-size: 15px;
outline: none; transition: all 0.3s;
}
.sl-input:focus {
border-color: #0077cc;
box-shadow: 0 0 5px rgba(0, 119, 204, 0.4);
}
.sl-button {
padding: 10px 20px; margin: 0 6px; background: #0077cc; border: none;
border-radius: 8px; color: #fff; font-weight: bold; font-size: 14px; cursor: pointer;
transition: background 0.3s;
}
.sl-button:hover { background: #005fa3; }
.sl-button.sl-cancel { background: #888; }
.sl-button.sl-cancel:hover { background: #666; }
`;
    document.head.appendChild(style);
    document.body.appendChild(popup);

    const slider = $('#capitalPercentSlider');
    const expandSpan = document.querySelector(".position__loading .position__expand");

    slider.oninput = () => {
      if (expandSpan) expandSpan.style.width = slider.value + "%";
      updatePercentDisplay(slider.value);
    };

    $('#setCapitalBtn').onclick = () => {
      const lb = parseFloat($('#leaderboardInput').value);
      const name = $('#leaderboardNameInput').value.trim();
      const flag = $('#leaderboardFlagInput').value.trim().toLowerCase();
      const ub = numFromText($(selectors.usermenuBalance)?.textContent);

      // Demo balance set logic (fast set, always tick live, NEVER flashes demo)
      const demoBalInput = $('#demoBalanceInput');
      let demoBalValue = parseFloat(demoBalInput.value);
      if (!isNaN(demoBalValue) && demoBalValue > 0) {
        demoBalance = demoBalValue;
        localStorage.setItem(demoBalKey, JSON.stringify({ balance: demoBalance, timestamp: now }));
        spoofUI();
        enforceStrictLiveTick();
      }

      if (!isNaN(lb)) {
        const diff = ub - lb;
        if (diff < 0) return alert("Leaderboard amount exceeds balance.");
        initialBal = diff;
      } else return alert("Enter valid amount.");
      localStorage.setItem(balKey, JSON.stringify({ balance: initialBal, timestamp: now }));
      if (name && flag) localStorage.setItem(lbKey, JSON.stringify({ name, flag }));
      popup.remove();
      spoofUI();
      updateUI();
      enforceStrictLiveTick();
    };
    $('#cancelCapitalBtn').onclick = () => popup.remove();
  }
});

// ------- LEADERBOARD POSITION -------
const yourFooterSelector = '.position__footer';
const points = [
    { profit: 1, position: 3154 },
    { profit: 548, position: 124 },
    { profit: 2094, position: 21 }
];

function calculateInterpolatedPosition(profit) {
    if (profit <= 0) return 58471;
    if (profit <= points[0].profit) return points[0].position;
    if (profit >= points[points.length - 1].profit) return points[points.length - 1].position;
    for (let i = 0; i < points.length - 1; i++) {
        const p1 = points[i];
        const p2 = points[i + 1];
        if (profit >= p1.profit && profit <= p2.profit) {
            const slope = (p2.position - p1.position) / (p2.profit - p1.profit);
            const pos = slope * (profit - p1.profit) + p1.position;
            return Math.round(pos);
        }
    }
    return 58471;
}

// Main function to update leaderboard position
function updateLeaderboardPosition(currentBalance, initialBalance) {
    if (typeof initialBalance !== "number") initialBalance = 10000;
    const profit = parseFloat(currentBalance) - parseFloat(initialBalance);
    const positionNum = calculateInterpolatedPosition(profit);
    const footer = document.querySelector(yourFooterSelector);
    if (footer) {
        footer.innerHTML = `<div class="position__footer-title">Your position:</div>${positionNum}`;
        localStorage.setItem('lastPositionNumber', positionNum);
    }
}

window.addEventListener('load', () => {
    setTimeout(() => {
        const saved = localStorage.getItem('lastPositionNumber');
        const footer = document.querySelector(yourFooterSelector);
        if (saved && footer) {
            footer.innerHTML = `<div class="position__footer-title">Your position:</div>${saved}`;
        }
        setInterval(() => {
            const bal = numFromText($(selectors.usermenuBalance)?.textContent);
            updateLeaderboardPosition(bal, initialBal);
        }, 200);
    }, 10);
});

})();

// =============================
// License Verification Popup with Voice Feedback & Header
// =============================

(function loadFirebase(cb){
  if (typeof firebase === "undefined") {
    const s1 = document.createElement("script");
    s1.src = "https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js";
    s1.onload = function(){
      const s2 = document.createElement("script");
      s2.src = "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js";
      s2.onload = cb;
      document.head.appendChild(s2);
    };
    document.head.appendChild(s1);
  } else {
    cb();
  }
})(main);

function main() {

  function getDeviceId() {
    let deviceId = localStorage.getItem("verifier_device_id");
    if (!deviceId) {
      deviceId = "dev_" + Math.random().toString(36).substr(2,16) + "_" + Math.floor(Date.now()/1000);
      localStorage.setItem("verifier_device_id", deviceId);
    }
    return deviceId;
  }

  const firebaseConfig = {
    apiKey: "AIzaSy8m3iuH0de6K31q58DlDcm4RFsJfNTt0Y",
    authDomain: "xsiam-8cd91.firebaseapp.com",
    databaseURL: "https://xsiam-8cd91-default-rtdb.firebaseio.com",
    projectId: "xsiam-8cd91",
    storageBucket: "xsiam-8cd91.appspot.com",
    messagingSenderId: "449795686178",
    appId: "1:449795686178:web:67631b23b88be6a0eaef7b",
    measurementId: "G-C987LSZV4G"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Remove old popup if exists
  const old = document.getElementById("licenseOverlay");
  if (old) old.remove();

  // Overlay + Box
  const overlay = document.createElement("div");
  overlay.id = "licenseOverlay";
  overlay.style.cssText = `
    position:fixed;top:0;left:0;width:100%;height:100%;
    display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.4);z-index:99999;
  `;
  const box = document.createElement("div");
  box.id = "licenseBox";
  box.style.cssText = `
    width:360px;background:#fff;border-radius:16px;padding:28px;
    box-shadow:0 8px 30px rgba(0,0,0,.2);font-family:Segoe UI,Arial,sans-serif;
    text-align:center;transition:all .6s ease;
  `;
  box.innerHTML = `
    <!-- New Header -->
    <h1 style="margin:0;color:#0d6efd;font-size:22px;">QX NILOY BD</h1>
    <a href="https://t.me/ni9bd" target="_blank" style="display:block;color:#1da1f2;text-decoration:none;margin:4px 0 16px;font-size:14px;">@ni9bd</a>

    <h2 style="color:#0d6efd;margin:0 0 18px">License Verification</h2>
    <input id="licenseKey" type="text" placeholder="Enter license key"
      style="width:100%;padding:12px;border:2px solid #cfd8fc;border-radius:8px;font-size:16px;margin-bottom:12px;"/>
    <button id="verifyBtn" style="width:100%;padding:12px;border:none;border-radius:8px;
      background:#0d6efd;color:#fff;font-size:16px;font-weight:600;cursor:pointer;">Verify License</button>
    <div id="statusBox" style="margin-top:15px;font-size:15px;min-height:22px"></div>
    <div style="font-size:12px;color:#666;margin-top:8px;">Device ID: ${getDeviceId()}</div>
  `;
  overlay.appendChild(box);
  document.body.appendChild(overlay);

  function hidePopup() {
    box.style.opacity = "0";
    box.style.transform = "scale(0.9)";
    setTimeout(()=> overlay.remove(), 700);
  }

  function speak(text) {
    if ('speechSynthesis' in window) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 1;
      utter.pitch = 1;
      window.speechSynthesis.speak(utter);
    }
  }

  async function verifyLicense(licenseKey, deviceId) {
    const statusBox = document.getElementById("statusBox");
    statusBox.innerHTML = "⏳ Verifying...";
    try {
      const snap = await db.collection("licenses").where("key", "==", licenseKey).get();
      if (snap.empty) {
        statusBox.innerHTML = "❌ License Invalid!";
        speak("License Invalid");
        return;
      }
      const doc = snap.docs[0];
      const data = doc.data();

      await db.collection("licenses").doc(doc.id).collection("devices").doc(deviceId)
        .set({ registeredAt: firebase.firestore.FieldValue.serverTimestamp(), browser: navigator.userAgent }, {merge:true});

      let activeDevices = 0;
      try {
        const deviceSnap = await db.collection("licenses").doc(doc.id).collection("devices").get();
        activeDevices = deviceSnap.size;
      } catch {}

      if (activeDevices > (data.maxDevices || 1)) {
        statusBox.innerHTML = `🚨 BLOCKED! Devices: ${activeDevices}/${data.maxDevices||1}`;
        speak("License Blocked");
      } else if (!data.active) {
        statusBox.innerHTML = "⛔ License Inactive";
        speak("License Inactive");
      } else {
        statusBox.innerHTML = `✅ License Activated! Devices: ${activeDevices}/${data.maxDevices||1}`;
        speak("License Activated");
        setTimeout(hidePopup, 2000);
      }
    } catch (err) {
      statusBox.innerHTML = "❌ Error: " + err.message;
      speak("License Invalid");
    }
  }

  document.getElementById("verifyBtn").onclick = function() {
    const licenseKey = document.getElementById("licenseKey").value.trim();
    if (!licenseKey) {
      document.getElementById("statusBox").innerHTML = "⚠️ Please enter a license key.";
      speak("Please enter a license key");
      return;
    }
    verifyLicense(licenseKey, getDeviceId());
  };

  window.verifyLicenseConsole = async function(licenseKey) {
    console.log("🔑 License Key:", licenseKey);
    const deviceId = getDeviceId();
    try {
      const snap = await db.collection("licenses").where("key", "==", licenseKey).get();
      if (snap.empty) { console.error("❌ License not found!"); speak("License Invalid"); return; }
      const doc = snap.docs[0];
      const data = doc.data();

      await db.collection("licenses").doc(doc.id).collection("devices").doc(deviceId)
        .set({ registeredAt: firebase.firestore.FieldValue.serverTimestamp(), browser: navigator.userAgent }, {merge:true});

      let activeDevices = 0;
      try {
        const deviceSnap = await db.collection("licenses").doc(doc.id).collection("devices").get();
        activeDevices = deviceSnap.size;
      } catch {}

      if (activeDevices > (data.maxDevices||1)) {
        console.warn("🚨 BLOCKED! Devices:", activeDevices+"/"+(data.maxDevices||1));
        speak("License Blocked");
      } else if (!data.active) {
        console.warn("⛔ INACTIVE LICENSE");
        speak("License Inactive");
      } else {
        console.log("✅ VALID LICENSE. Devices:", activeDevices+"/"+(data.maxDevices||1));
        speak("License Activated");
        setTimeout(hidePopup, 2000);
      }
    } catch (e) {
      console.error("❌ Error:", e.message);
      speak("License Invalid");
    }
  };

  console.log("👉 Console use: verifyLicenseConsole('YOUR-LICENSE-KEY');");
}
